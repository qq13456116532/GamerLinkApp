<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:GamerLinkApp.ViewModels"
             x:Class="GamerLinkApp.Views.ProfilePage"
             x:Name="ProfilePageView"
             x:DataType="vm:ProfileViewModel"
             Title="Profile"
             BackgroundColor="#F4F5F7">
    <Grid RowDefinitions="Auto,*">
        <ScrollView Grid.Row="1"
                    Padding="0,12,0,24">
            <VerticalStackLayout Spacing="18"
                                  Padding="20,0,20,0">

                <!-- User card -->
                <Border Padding="24,32"
                        StrokeThickness="0"
                        BackgroundColor="Transparent">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="24" />
                    </Border.StrokeShape>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#E9F0FF" Offset="0" />
                            <GradientStop Color="#FFE9F3" Offset="1" />
                        </LinearGradientBrush>
                    </Border.Background>

                    <VerticalStackLayout Spacing="14"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center">
                        <Border WidthRequest="96"
                                HeightRequest="96"
                                StrokeThickness="0"
                                BackgroundColor="#1A1A1A"
                                HorizontalOptions="Center"
                                VerticalOptions="Center">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="48" />
                            </Border.StrokeShape>
                            <Image Source="{Binding AvatarUrl}"
                                   Aspect="AspectFill" />
                        </Border>

                        <Label Text="{Binding DisplayNickname}"
                               FontSize="19"
                               FontAttributes="Bold"
                               TextColor="#1A1A1A"
                               HorizontalOptions="Center" />

                        <Label Text="{Binding DisplayUserId}"
                               FontSize="14"
                               TextColor="#666666"
                               HorizontalOptions="Center" />

                        <Label Text="{Binding TotalPaid, StringFormat='总消费 ¥{0:F0}'}"
                               FontSize="13"
                               TextColor="#80869A"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Border>

                <!-- Order summary -->
                <Border BackgroundColor="White"
                        Padding="20"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#14000000"
                                Offset="0,6"
                                Radius="12" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="20">
                        <Grid ColumnDefinitions="*,Auto"
                              VerticalOptions="Center">
                            <Label Text="订单概览"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#1A1A1A" />
                            <Label Text="全部订单"
                                   Grid.Column="1"
                                   FontSize="14"
                                   TextColor="#00AEEF">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnAllOrdersTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>

                        <CollectionView ItemsSource="{Binding OrderStatuses}"
                                        SelectionMode="None">
                            <CollectionView.ItemsLayout>
                                <GridItemsLayout Orientation="Vertical"
                                                 Span="4"
                                                 HorizontalItemSpacing="18" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:ProfileViewModel+OrderStatusItem">
                                    <VerticalStackLayout Spacing="6"
                                                         HorizontalOptions="Center"
                                                         VerticalOptions="Center">
                                        <VerticalStackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={x:Reference ProfilePageView}, Path=BindingContext.OrderStatusTappedCommand}"
                                                                  CommandParameter="{Binding .}" />
                                        </VerticalStackLayout.GestureRecognizers>
                                        <Grid WidthRequest="56"
                                              HeightRequest="56"
                                              ColumnDefinitions="Auto"
                                              RowDefinitions="Auto"
                                              VerticalOptions="Center"
                                              HorizontalOptions="Center">
                                            <Border StrokeThickness="0"
                                                    BackgroundColor="#F1F2FF"
                                                    WidthRequest="56"
                                                    HeightRequest="56"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="Center">
                                                <Border.StrokeShape>
                                                    <RoundRectangle CornerRadius="18" />
                                                </Border.StrokeShape>
                                            </Border>
                                            <Image Source="{Binding Icon}"
                                                   WidthRequest="28"
                                                   HeightRequest="28"
                                                   Aspect="AspectFit"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Grid>

                                        <Label Text="{Binding DisplayName}"
                                               FontSize="13"
                                               TextColor="#4B4F5F"
                                               HorizontalOptions="Center" />
                                        <Label Text="{Binding CountDisplay}"
                                               FontSize="12"
                                               TextColor="#9A9EAE"
                                               HorizontalOptions="Center" />
                                    </VerticalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!-- Stats -->
                <Border BackgroundColor="White"
                        Padding="20"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="完成订单"
                                   FontSize="15"
                                   TextColor="#1A1A1A" />
                            <Label Text="{Binding CompletedOrders, StringFormat='{0} 个'}"
                                   Grid.Column="1"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="#5B61FF" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Actions -->
                <VerticalStackLayout Spacing="12">
                    <Border BackgroundColor="White"
                            Padding="16"
                            StrokeThickness="0"
                            IsVisible="{Binding IsAdmin}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="*,Auto"
                              VerticalOptions="Center">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding NavigateToAdminCommand}" />
                            </Grid.GestureRecognizers>

                            <Label Text="管理面板"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="#1A1A1A" />
                            <Label Text=">"
                                   Grid.Column="1"
                                   FontSize="16"
                                   TextColor="#C0C0C0" />
                        </Grid>
                    </Border>

                    <Border BackgroundColor="White"
                            Padding="16"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="*,Auto"
                              VerticalOptions="Center">
                            <Label Text="我的收藏"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="#1A1A1A">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnFavoritesTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                            <Label Text=">"
                                   Grid.Column="1"
                                   FontSize="16"
                                   TextColor="#C0C0C0">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnFavoritesTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>

                    <Border BackgroundColor="White"
                            Padding="16"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="*,Auto"
                              VerticalOptions="Center">
                            <Label Text="账号安全"
                                   FontSize="15"
                                   TextColor="#1A1A1A" />
                            <Label Text=">"
                                   Grid.Column="1"
                                   FontSize="16"
                                   TextColor="#C0C0C0" />
                        </Grid>
                    </Border>

                    <Border BackgroundColor="White"
                            Padding="16"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="*,Auto"
                              VerticalOptions="Center">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnSupportTapped" />
                            </Grid.GestureRecognizers>
                            <Label Text="联系客服"
                                   FontSize="15"
                                   TextColor="#1A1A1A">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSupportTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                            <Label Text=">"
                                   Grid.Column="1"
                                   FontSize="16"
                                   TextColor="#C0C0C0">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnSupportTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>
                    </Border>

                    <Button Text="退出登录"
                            Command="{Binding LogoutCommand}"
                            HeightRequest="48"
                            Margin="0,24,0,0"
                            BackgroundColor="#FF4D4F"
                            TextColor="White"
                            CornerRadius="16" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
